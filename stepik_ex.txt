--- 1.2/7 ---
При анализе продаж книг выяснилось, что наибольшей популярностью пользуются книги Михаила Булгакова, на втором месте книги Сергея Есенина. Исходя из этого решили поднять цену книг Булгакова на 10%, а цену книг Есенина - на 5%. Написать запрос, куда включить автора, название книги и новую цену, последний столбец назвать new_price. Значение округлить до двух знаков после запятой.

SELECT author, title, 
	ROUND(IF(author='Булгаков М.А.', price*1.1, 
	IF(author='Есенин С.А.', price*1.05, price)),2) AS new_price 
FROM book;


--- 1.3/5 ---
Для каждого автора вычислить суммарную стоимость книг S (имя столбца Стоимость), а также вычислить налог на добавленную стоимость  для полученных сумм (имя столбца НДС ) , который включен в стоимость и составляет k = 18%,  а также стоимость книг  (Стоимость_без_НДС) без него. Значения округлить до двух знаков после запятой. В запросе для расчета НДС(tax)  и Стоимости без НДС(S_without_tax) использовать следующие формулы:

SELECT author, SUM(price*amount) AS Стоимость, 
	ROUND(((SUM(price*amount)*0.18)/1.18),2) AS НДС,
	Round((SUM(price*amount)/1.18),2) AS Стоимость_без_НДС
FROM book
GROUP BY author


--- 1.3/8 ---
Посчитать стоимость всех экземпляров каждого автора без учета книг «Идиот» и «Белая гвардия». В результат включить только тех авторов, у которых суммарная стоимость книг более 5000 руб. Результат отсортировать по убыванию стоимости.

SELECT author, SUM(price*amount) AS Стоимость
FROM book
WHERE title<>'Белая гвардия' AND title<>'Идиот'
GROUP BY author
HAVING SUM(price*amount) > 5000
ORDER BY Стоимость DESC


--- 1.4/2 ---
Вывести информацию (автора, название и цену) о  книгах, цены которых меньше или равны средней цене книг на складе. Информацию вывести в отсортированном по убыванию цены виде. Среднее вычислить как среднее по цене книги.

SELECT author, title, price
FROM book
WHERE price <= (
	SELECT AVG(price) FROM book
	)
ORDER BY price DESC


--- 1.5/8 ---
Для тех книг в таблице book , которые есть в таблице supply, не только увеличить их количество в таблице book( увеличить их количество на значение столбца amountтаблицы supply), но и пересчитать их цену (для каждой книги найти сумму цен из таблиц book и supply и разделить на 2).

UPDATE book, supply
SET book.amount = book.amount + supply.amount,
book.price = (book.price + supply.price)/2
WHERE book.title = supply.title AND book.author = supply.author


--- 1.5/10 ---
Создать таблицу заказ (ordering), куда включить авторов и названия тех книг, количество экземпляров которых в таблице book меньше среднего количества экземпляров книг в таблице book. В таблицу включить столбец   amount, в котором для всех книг указать одинаковое значение - среднее количество экземпляров книг в таблице book.

CREATE TABLE ordering AS
SELECT author, title, 
   (
    SELECT ROUND(AVG(amount)) 
    FROM book
   ) AS amount
FROM book
WHERE amount < (
    SELECT AVG(amount) FROM book
) 


--- 1.6/2 ---
Вывести из таблицы trip информацию о командировках тех сотрудников, фамилия которых заканчивается на букву «а», в отсортированном по убыванию даты последнего дня командировки виде. В результат включить столбцы name, city, per_diem, date_first, date_last.

SELECT name, city, per_diem, date_first, date_last FROM trip
WHERE name LIKE '%а %'
ORDER BY date_last DESC


--- 1.6/9 ---
Вывести название месяца и количество командировок для каждого месяца. Считаем, что командировка относится к некоторому месяцу, если она началась в этом месяце. Информацию вывести сначала в отсортированном по убыванию количества, а потом в алфавитном порядке по названию месяца виде. Название столбцов – Месяц и Количество.

SELECT MONTHNAME(date_first) AS Месяц, COUNT(MONTHNAME(date_first)) AS Количество FROM trip
GROUP BY Месяц 
ORDER BY Количество DESC, Месяц ASC


--- 1.6/10 ---
Вывести сумму суточных (произведение количества дней командировки и размера суточных) для командировок, первый день которых пришелся на февраль или март 2020 года. Значение суточных для каждой командировки занесено в столбец  per_diem. Информацию отсортировать сначала  в алфавитном порядке по фамилиям сотрудников, а затем по убыванию суммы суточных.

SELECT name, city, date_first, (datediff(date_last, date_first) + 1) * per_diem AS Сумма FROM trip
WHERE MONTH(date_first) = 2 OR MONTH(date_first) = 3
ORDER BY name ASC, Сумма DESC


--- 1.6/11 ---
Вывести фамилию с инициалами и общую сумму суточных, полученных за все командировки для тех сотрудников, которые были в командировках больше чем 3 раза, в отсортированном по убыванию сумм суточных виде. Только для этого задания изменена строка таблицы trip:

SELECT name, SUM((DATEDIFF(date_last, date_first) + 1) * per_diem) AS Сумма FROM trip
GROUP BY name
HAVING count(name)>3
ORDER BY Сумма DESC